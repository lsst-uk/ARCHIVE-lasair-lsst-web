{% extends "base.html"%}
{% load static %}
{% block content %}


    <!-- Mask & flexbox options-->
<h4 class="text-gray text-center">
Lasair is a broker for astronomical transients
</h4>
<h6 class="text-gray text-center">
a collaboration between the<br/>
<a href=https://www.ed.ac.uk/>University of Edinburgh</a> and
<a href=http://www.qub.ac.uk/>Queen's University, Belfast</a><br/>
for alerts generated by the
<a href=https://www.lsst.org/>Vera C. Rubin Observatory</a>
</h6>
Some recent possible supernovae are below. For full information, click the Object link.



<script type="text/javascript" src="{% static '/js/plotly-latest.min.js' %}" ></script>
<script type="text/javascript" src="{% static '/js/lc.js' %}" ></script>
<!--<script type="text/javascript" src="{% static '/js/lc_apparent.js' %}" ></script> -->
<script type="text/javascript" src="//code.jquery.com/jquery-1.12.1.min.js" charset="utf-8"></script>
<script type="text/javascript" src="{% static '/js/jquery.tablesorter.min.js' %}" ></script>
<link rel="stylesheet" href="//aladin.u-strasbg.fr/AladinLite/api/v2/latest/aladin.min.css" />

<script src="{% static 'js/surveys.js' %}"></script>
<script src="{% static 'js/aladin.js' %}"></script>
<script src="{% static 'js/fitsview_init.js' %}"></script>
<script src="{% static 'js/fitsview.js' %}"></script>

{{ message }}

<div class="container">
{% for data in datas %}
<hr/>
<h6>Object <a href=/object/{{ data.objectId }}>{{ data.objectId }}</a></h6>
  <div class="row">
    <div class="w-50" id="lc{{ forloop.counter0 }}" style="width:200px;height:200px;"></div>
    <div class="w-50">
      <div id="aladin-lite-div{{ forloop.counter0 }}" style="width:200px;height:200px;"></div>
    </div>
  </div>
<script type="text/javascript">
	var aladin = A.aladin('#aladin-lite-div{{ forloop.counter0 }}', {survey: "P/PanSTARRS/DR1/color-z-zg-g", fov:0.025, target: "{{ data.objectData.ramean }}, {{ data.objectData.decmean }}", showLayersControl:false, showZoomControl:false, showFullscreenControl:false, showGotoControl:false});

    aladin.showLayerBox();
    $('input[name=survey]').change(function() {
        aladin.setImageSurvey($(this).val());
    });

    var alertcat = A.catalog({name: 'Alert', sourceSize: 18, color:'red'});
    var alert = A.source({{ data.objectData.ramean }}, {{ data.objectData.decmean }});
    alertcat.addSources([alert]);
    aladin.addCatalog(alertcat);

    {% if data.sherlock.eastSeparationArcsec %}
        var sherlockcat = A.catalog({name: 'Sherlock', sourceSize: 18, color:'blue'});
        var sherlock = A.source(
	    {{ data.objectData.ramean }} + {{ data.sherlock.eastSeparationArcsec }}/3600, 
	    {{ data.objectData.decmean }} + {{ data.sherlock.northSeparationArcsec }}/3600);
        sherlockcat.addSources([sherlock]);
        aladin.addCatalog(sherlockcat);
    {% endif %}

    console.log('starting light curve {{ forloop.counter0 }}');
    var pd = "{{ data.json }}";
    pd = pd.replace(/&quot;/g,'"')
    var json_data = JSON.parse(pd);
    plotlc(json_data, 'lc{{ forloop.counter0 }}', false);
</script>

{% endfor %}
</div>
{% endblock %}
