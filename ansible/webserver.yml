# sudo apt update
# sudo apt-add-repository ppa:ansible/ansible
# sudo apt install ansible
# sudo apt install python3-pip
# sudo pip3 install --upgrade pip
---
- hosts: localhost
  connection: local
  gather_facts: no
  tasks:
    - name: install python3-pip
      apt: 
          name: python3-pip
          state: present
          update_cache: true
      become: yes

    - name: install apache2
      apt: 
          name: apache2
          state: present
          update_cache: true
      become: yes

    - name: install apache2-utils
      apt: 
          name: apache2-utils
          state: present
          update_cache: true
      become: yes

    - name: install apache2-dev
      apt: 
          name: apache2-dev
          state: present
          update_cache: true
      become: yes

    - name: install libexpat1
      apt: 
          name: libexpat1
          state: present
          update_cache: true
      become: yes

    - name: install ssl-cert
      apt: 
          name: ssl-cert
          state: present
          update_cache: true
      become: yes

    - name: install libmysqlclient-dev
      apt: 
          name: libmysqlclient-dev
          state: present
          update_cache: true
      become: yes

    - name: install swig-pip
      apt: 
          name: swig
          state: present
          update_cache: true
      become: yes

    - name: install libapache2-mod-wsgi-py3
      apt: 
          name: libapache2-mod-wsgi-py3
          state: present
          update_cache: true
      become: yes

    - name: install mysql.connector
      pip: 
          executable: pip3 
          name: mysql-connector-python

    - name: install django
      pip: 
          executable: pip3 
          name: django

    - name: install pyephem
      pip: 
          executable: pip3 
          name: pyephem

    - name: install requests
      pip: 
          executable: pip3 
          name: requests

    - name: install MOCpy
      pip: 
          executable: pip3 
          name: MOCpy

    - name: install astropy
      pip: 
          executable: pip3 
          name: astropy

    - name: install fastavro
      pip:
          executable: pip3
          name: fastavro
      become: yes

      #    - name: install mod-wsgi
      #      pip: 
      #          executable: pip3 
      #          name: mod-wsgi

      #    - name: configure mod-wsgi
      #      shell:
      #         cmd: mod_wsgi-express module-config > /etc/apache2/mods-available/wsgi.load
      #      become: yes

    - name: copy conf file
      shell: 
          cmd: cp ../conf/webserver.conf /etc/apache2/sites-available
      become: yes

    - name: link it from sites-enabled
      file:
          src:  /etc/apache2/sites-available/webserver.conf
          dest: /etc/apache2/sites-enabled/webserver.conf
          state: link
      become: yes
